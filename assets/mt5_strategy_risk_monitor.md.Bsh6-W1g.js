import{_ as l,c as a,aI as t,o}from"./chunks/framework.b7dag8kZ.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://vite.dev/mt5_strategy/risk_monitor"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"mt5_strategy/risk_monitor.md","filePath":"mt5_strategy/risk_monitor.md","lastUpdated":1746376832000}'),e={name:"mt5_strategy/risk_monitor.md"};function r(n,i,s,d,c,h){return o(),a("div",null,i[0]||(i[0]=[t('<h3 id="_36-教学ea-riskmonitor-风险监控-全局变量-定时器-原文" tabindex="-1">36. 教学EA-RiskMonitor-风险监控-全局变量-定时器_原文 <a class="header-anchor" href="#_36-教学ea-riskmonitor-风险监控-全局变量-定时器-原文" aria-label="Permalink to &quot;36. 教学EA-RiskMonitor-风险监控-全局变量-定时器_原文&quot;">​</a></h3><h4 id="_2025年04月17日-21-40" tabindex="-1">2025年04月17日 21:40 <a class="header-anchor" href="#_2025年04月17日-21-40" aria-label="Permalink to &quot;2025年04月17日 21:40&quot;">​</a></h4><h4 id="一、ea功能与风控背景" tabindex="-1">一、EA功能与风控背景 <a class="header-anchor" href="#一、ea功能与风控背景" aria-label="Permalink to &quot;一、EA功能与风控背景&quot;">​</a></h4><p>我们今天讲解一个特殊的EA，其核心逻辑是“抛硬币式交易”（随机开多/空），旨在通过简单场景介绍<strong>账户风险监控体系</strong>。这类风控手段常用于：</p><ul><li><strong>比赛规则限制</strong>：如账户总回撤≤10%、单日回撤≤5%等。</li><li><strong>风险资金平台</strong>：平台通过苛刻规则控制资金风险（如单日亏损笔数限制），筛选合格操盘手。</li></ul><h4 id="二、核心风控规则" tabindex="-1">二、核心风控规则 <a class="header-anchor" href="#二、核心风控规则" aria-label="Permalink to &quot;二、核心风控规则&quot;">​</a></h4><ol><li><p><strong>总账户回撤控制</strong></p><ul><li>设定允许的最大回撤比例（如40%），当账户利润回撤超过该比例时，暂停交易。</li></ul></li><li><p><strong>每日回撤控制</strong></p><ul><li>每日凌晨记录账户初始余额，以该余额为基准计算当日最大允许亏损（如5%）。</li><li>示例：1月24日凌晨余额100,000美元，当日最大允许亏损为5,000美元（100,000×5%）。</li></ul></li><li><p><strong>每日交易笔数控制</strong></p><ul><li>限制单日最大交易笔数（如10笔），超过则禁止开仓。</li><li><strong>课后作业</strong>：将“每日交易笔数”改为“每日亏损笔数”控制（如允许单日最多14笔亏损，第15笔时停止交易）。</li></ul></li></ol><h4 id="三、实现细节" tabindex="-1">三、实现细节 <a class="header-anchor" href="#三、实现细节" aria-label="Permalink to &quot;三、实现细节&quot;">​</a></h4><h5 id="_1-外部参数与全局变量" tabindex="-1">1. 外部参数与全局变量 <a class="header-anchor" href="#_1-外部参数与全局变量" aria-label="Permalink to &quot;1. 外部参数与全局变量&quot;">​</a></h5><ul><li><p><strong>参数</strong>：</p><ul><li><code>account_max_dd</code>：总账户最大回撤比例（如40%）。</li><li><code>day_max_dd</code>：单日最大回撤比例（如5%）。</li><li><code>day_max_positions_total</code>：单日最大交易笔数（如10笔）。</li><li><code>hide_chart</code>：隐藏图表无关信息（便于监控）。</li></ul></li><li><p><strong>全局变量方法</strong>：</p><ul><li><code>get_account_balance()</code>：获取账户余额。</li><li><code>get_account_equity()</code>：获取账户净值。</li><li><code>get_account_currency()</code>：获取账户货币单位。</li></ul></li></ul><h5 id="_2-图表对象与信息展示" tabindex="-1">2. 图表对象与信息展示 <a class="header-anchor" href="#_2-图表对象与信息展示" aria-label="Permalink to &quot;2. 图表对象与信息展示&quot;">​</a></h5><ul><li>通过<code>ObjectCreate</code>创建图表文本对象，显示风控状态（如总回撤、单日回撤、交易笔数）。</li><li>颜色标识：绿色（正常）、红色（亏损/超限）、白色（持平）。</li><li><strong>隐藏图表技巧</strong>：在MT5测试环境中，通过手动设置网格线、蜡烛线颜色为黑色，实现图表简化。</li></ul><h5 id="_3-核心逻辑-on-tick与风控检查" tabindex="-1">3. 核心逻辑：<code>on_tick</code>与风控检查 <a class="header-anchor" href="#_3-核心逻辑-on-tick与风控检查" aria-label="Permalink to &quot;3. 核心逻辑：`on_tick`与风控检查&quot;">​</a></h5><ul><li><p><strong>交易逻辑</strong>：随机开多/空，固定10点止盈止损，使用账户1%资金计算手数。</p></li><li><p><strong>每日回撤重置</strong>：</p><ul><li>每日凌晨记录当日初始余额（<code>day_balance</code>），作为当日回撤计算基准。</li><li>遍历历史订单，计算当日已结算利润（含手续费、隔夜费）和交易笔数。</li></ul></li><li><p><strong>风控判断</strong>：</p><ol><li><strong>总账户回撤</strong>：若账户净值 &lt; 初始加载时的余额×(1-<code>account_max_dd</code>)，禁止交易。</li><li><strong>单日回撤</strong>：若当前余额 &lt; <code>day_balance</code>×(1-<code>day_max_dd</code>)，禁止交易。</li><li><strong>交易笔数</strong>：若当日交易笔数 ≥ <code>day_max_positions_total</code>，禁止交易。</li></ol></li></ul><h5 id="_4-多ea共享风控状态-全局变量" tabindex="-1">4. 多EA共享风控状态：全局变量 <a class="header-anchor" href="#_4-多ea共享风控状态-全局变量" aria-label="Permalink to &quot;4. 多EA共享风控状态：全局变量&quot;">​</a></h5><ul><li><strong>问题</strong>：单EA的局部变量无法被其他EA获取，需通过<strong>全局变量</strong>同步状态。</li><li><strong>MQL5实现</strong>： <ul><li><code>GlobalVariableSet(&quot;global_is_trade_allowed&quot;, 1)</code>：设置允许交易（1为允许，-1为禁止）。</li><li><code>GlobalVariableGet(&quot;global_is_trade_allowed&quot;)</code>：其他EA读取状态，统一控制交易。</li></ul></li><li><strong>特性</strong>：全局变量值存储在硬盘，MT5重启后不丢失。</li></ul><h5 id="_5-定时器优化-on-timer" tabindex="-1">5. 定时器优化：<code>on_timer</code> <a class="header-anchor" href="#_5-定时器优化-on-timer" aria-label="Permalink to &quot;5. 定时器优化：`on_timer`&quot;">​</a></h5><ul><li><strong>痛点</strong>：<code>on_tick</code>高频触发风控计算，占用资源。</li><li><strong>优化</strong>：通过<code>on_timer</code>定时执行（如每隔60秒），减少计算频率。<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在on_init中启动定时器（单位：秒）  </span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetTimer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 每分钟执行一次on_timer</span></span></code></pre></div></li><li><strong>注意</strong>：需在<code>on_deinit</code>中清除定时器，避免资源泄漏。</li></ul><h4 id="四、盘面演示与效果" tabindex="-1">四、盘面演示与效果 <a class="header-anchor" href="#四、盘面演示与效果" aria-label="Permalink to &quot;四、盘面演示与效果&quot;">​</a></h4><ul><li><strong>参数设置</strong>：总回撤20%，单日回撤5%，单日最大交易笔数10笔。</li><li><strong>演示场景</strong>： <ol><li>初始资金10,000美元，单日允许亏损500美元。</li><li>交易笔数超限或回撤超标时，图表显示红色警告并禁止交易。</li><li>次日凌晨重置当日初始余额，恢复风控计算。</li></ol></li></ul><h4 id="五、总结与扩展" tabindex="-1">五、总结与扩展 <a class="header-anchor" href="#五、总结与扩展" aria-label="Permalink to &quot;五、总结与扩展&quot;">​</a></h4><ul><li><strong>核心价值</strong>：通过简单EA理解账户级风控（总回撤、单日回撤、交易笔数）。</li><li><strong>扩展方向</strong>：添加单日最大盈利、仓位限制等规则，使用全局变量实现多EA协同风控。</li><li><strong>课后任务</strong>：修改每日亏损笔数控制逻辑，完善风控体系。</li></ul>',22)]))}const u=l(e,[["render",r]]);export{g as __pageData,u as default};
