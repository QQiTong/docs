import{_ as s,c as a,ag as t,o as l}from"./chunks/framework.CCnnzLsu.js";const g=JSON.parse('{"title":"MT5CTP基础函数 合约、持仓","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://vite.dev/mt5_ctp/quick_start/position_info"}],["meta",{"property":"og:title","content":"MT5CTP基础函数 合约、持仓"}]]},"headers":[],"relativePath":"mt5_ctp/quick_start/position_info.md","filePath":"mt5_ctp/quick_start/position_info.md","lastUpdated":null}'),n={name:"mt5_ctp/quick_start/position_info.md"};function h(e,i,p,k,o,r){return l(),a("div",null,i[0]||(i[0]=[t(`<h1 id="mt5ctp基础函数-合约、持仓" tabindex="-1">MT5CTP基础函数 合约、持仓 <a class="header-anchor" href="#mt5ctp基础函数-合约、持仓" aria-label="Permalink to &quot;MT5CTP基础函数 合约、持仓&quot;">​</a></h1><h2 id="课程引入-合约的核心地位" tabindex="-1">课程引入：合约的核心地位 <a class="header-anchor" href="#课程引入-合约的核心地位" aria-label="Permalink to &quot;课程引入：合约的核心地位&quot;">​</a></h2><p>大家好，继续MT5 CTP的学习。上节课介绍了账户基础函数，本次课聚焦<strong>合约</strong>与<strong>持仓</strong>。期货交易的核心对象是<strong>合约</strong>（如螺纹钢RB888、沪铜CU888），其操作逻辑与账户类似，需通过库文件引入和对象定义实现。</p><h2 id="一、合约基础函数" tabindex="-1">一、合约基础函数 <a class="header-anchor" href="#一、合约基础函数" aria-label="Permalink to &quot;一、合约基础函数&quot;">​</a></h2><h3 id="_1-引入合约库与定义对象" tabindex="-1">1. 引入合约库与定义对象 <a class="header-anchor" href="#_1-引入合约库与定义对象" aria-label="Permalink to &quot;1. 引入合约库与定义对象&quot;">​</a></h3><ul><li><strong>库文件</strong>：<code>#include &lt;MT5CTP/Symbol/SymbolInfo.mqh&gt;</code></li><li><strong>对象定义</strong>：<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MT5CTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CSymbolInfo m_symbol;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 定义合约信息对象</span></span></code></pre></div><ul><li>通过右键点击库文件可查看<code>CSymbolInfo</code>类的定义，包含合约代码、价格、涨跌停板等成员变量和方法。</li></ul></li></ul><h3 id="_2-选择合约-必须先指定操作对象" tabindex="-1">2. 选择合约：必须先指定操作对象 <a class="header-anchor" href="#_2-选择合约-必须先指定操作对象" aria-label="Permalink to &quot;2. 选择合约：必须先指定操作对象&quot;">​</a></h3><ul><li><strong>语法</strong>：<code>m_symbol.Select(&quot;RB888&quot;);</code>（选择螺纹钢主力合约）</li><li><strong>返回值</strong>：布尔类型，判断选择是否成功（避免输入错误合约代码）：<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> select_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m_symbol.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RB888&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;合约选择结果：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, select_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;成功&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div></li></ul><h3 id="_3-获取合约基础信息" tabindex="-1">3. 获取合约基础信息 <a class="header-anchor" href="#_3-获取合约基础信息" aria-label="Permalink to &quot;3. 获取合约基础信息&quot;">​</a></h3><ul><li><p><strong>产品代码</strong>：<code>string product_id = m_symbol.ProductID();</code></p></li><li><p><strong>最新价</strong>：<code>double last_price = m_symbol.LastPrice();</code></p></li><li><p><strong>涨停板价</strong>：<code>double upper_limit = m_symbol.UpperLimit();</code></p></li><li><p><strong>跌停板价</strong>：<code>double lower_limit = m_symbol.LowerLimit();</code></p></li><li><p><strong>卖一价（申卖价）</strong>：<code>double ask_price = m_symbol.Ask();</code></p></li><li><p><strong>买一价（申买价）</strong>：<code>double bid_price = m_symbol.Bid();</code></p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 示例：输出合约关键信息  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;产品代码：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product_id);  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;最新价：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, last_price);  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;涨停板价：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, upper_limit);</span></span></code></pre></div></li></ul><h3 id="_4-郭老师封装的合约数据脚本" tabindex="-1">4. 郭老师封装的合约数据脚本 <a class="header-anchor" href="#_4-郭老师封装的合约数据脚本" aria-label="Permalink to &quot;4. 郭老师封装的合约数据脚本&quot;">​</a></h3><ul><li><strong>脚本位置</strong>：<code>MT5CTP/图表合约数据.mq5</code></li><li><strong>功能</strong>：批量输出合约的详细信息（成交量、是否主力合约等），支持当前激活窗口合约的自动识别。</li></ul><h2 id="二、持仓管理-mt5持仓-vs-ctp持仓" tabindex="-1">二、持仓管理：MT5持仓 vs CTP持仓 <a class="header-anchor" href="#二、持仓管理-mt5持仓-vs-ctp持仓" aria-label="Permalink to &quot;二、持仓管理：MT5持仓 vs CTP持仓&quot;">​</a></h2><h3 id="_1-两种持仓模式对比" tabindex="-1">1. 两种持仓模式对比 <a class="header-anchor" href="#_1-两种持仓模式对比" aria-label="Permalink to &quot;1. 两种持仓模式对比&quot;">​</a></h3><table tabindex="0"><thead><tr><th><strong>特性</strong></th><th><strong>MT5持仓</strong></th><th><strong>CTP持仓</strong></th></tr></thead><tbody><tr><td><strong>数据存储</strong></td><td>本地存储（记录开仓策略、Magic号等）</td><td>交易所数据（仅显示合约统一持仓）</td></tr><tr><td><strong>区分能力</strong></td><td>支持多策略分仓（通过Magic号）</td><td>仅按合约汇总，无法区分开仓策略</td></tr><tr><td><strong>止盈止损</strong></td><td>软件内置个性化设置（本地执行）</td><td>依赖交易所或第三方平台</td></tr></tbody></table><h3 id="_2-mt5持仓-个性化分仓管理" tabindex="-1">2. MT5持仓：个性化分仓管理 <a class="header-anchor" href="#_2-mt5持仓-个性化分仓管理" aria-label="Permalink to &quot;2. MT5持仓：个性化分仓管理&quot;">​</a></h3><ul><li><strong>获取持仓总数</strong>：<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _MT5CTP_</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 启用国内期货模式  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;MT5CTP/Position/PositionInfo.mqh&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_positions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Total</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 获取MT5持仓总数</span></span></code></pre></div></li><li><strong>遍历持仓</strong>：通过<code>for</code>循环遍历所有持仓，获取单个持仓信息（订单号、合约、开仓价、止损价等）：<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">total_positions; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ticket </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 获取第i个持仓的订单号  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SelectByTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ticket);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 选择持仓  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    string symbol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 获取合约代码  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> open_price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OpenPrice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 开仓价  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;订单号：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ticket, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;，合约：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, symbol, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;，开仓价：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, open_price);  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>关键语法</strong>： <ul><li><code>Continue</code>：跳过当前循环体后续代码，直接进入下一次循环（用于处理无效持仓）。</li><li><code>结构体数组</code>：郭老师封装的<code>MyPosition</code>结构体，存储持仓详细信息（订单号、合约、类型、时间等）。</li></ul></li></ul><h3 id="_3-ctp持仓-交易所级统一持仓" tabindex="-1">3. CTP持仓：交易所级统一持仓 <a class="header-anchor" href="#_3-ctp持仓-交易所级统一持仓" aria-label="Permalink to &quot;3. CTP持仓：交易所级统一持仓&quot;">​</a></h3><ul><li><strong>特点</strong>：仅显示同一合约的汇总持仓，不区分开仓策略（如三次买入同一合约仅显示一个持仓）。</li><li><strong>获取持仓</strong>：<div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;MT5CTP/CTPPosition/CTPPositionInfo.mqh&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CCTPPositionInfo ctp_position;  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctp_total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctp_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Total</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 获取CTP持仓总数  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctp_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SelectByIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 选择第一个持仓（按合约汇总）  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">string ctp_symbol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctp_position.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div></li></ul><h2 id="三、实战建议与代码规范" tabindex="-1">三、实战建议与代码规范 <a class="header-anchor" href="#三、实战建议与代码规范" aria-label="Permalink to &quot;三、实战建议与代码规范&quot;">​</a></h2><ol><li><strong>合约操作流程</strong>：<br> ① 引入合约库 → ② 定义对象 → ③ 选择合约（<code>Select</code>）→ ④ 获取信息。</li><li><strong>持仓操作注意</strong>： <ul><li>MT5持仓需通过<code>Define _MT5CTP_</code>启用国内模式，避免与外盘持仓混淆。</li><li>优先使用MT5持仓进行策略开发（支持分仓管理和个性化止盈止损）。</li></ul></li><li><strong>代码调试</strong>： <ul><li>右键点击函数名可跳转库文件查看定义，F1调用帮助文档。</li><li>编译前确保合约代码正确（如RB888、CU2211），避免<code>Select</code>失败。</li></ul></li></ol><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>本次课介绍了MT5 CTP中合约与持仓的核心函数：</p><ul><li><strong>合约</strong>：通过<code>CSymbolInfo</code>类获取代码、价格、涨跌停等基础信息，操作前必须先<code>Select</code>合约。</li><li><strong>持仓</strong>：MT5持仓支持多策略分仓（推荐使用），CTP持仓仅显示合约汇总信息，两者通过不同库文件区分。</li></ul><p><strong>练习建议</strong>：</p><ol><li>编写脚本输出当前合约的最新价、涨停板价、买一价。</li><li>模拟开仓后，使用MT5持仓函数获取订单号、开仓价和止损价。</li></ol><p>后续课程将深入讲解交易指令（下单、平仓）和策略开发，逐步构建完整的量化交易框架。</p>`,27)]))}const E=s(n,[["render",h]]);export{g as __pageData,E as default};
