import{_ as i,c as a,aI as n,o as h}from"./chunks/framework.b7dag8kZ.js";const l="/assets/1.jRV92w1m.png",o=JSON.parse('{"title":"教学EA-IchimokuTrendFlow-市场噪声_原文","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://vite.dev/mt5_strategy/IchimokuTrendFlow"}],["meta",{"property":"og:title","content":"教学EA-IchimokuTrendFlow-市场噪声_原文"}]]},"headers":[],"relativePath":"mt5_strategy/IchimokuTrendFlow.md","filePath":"mt5_strategy/IchimokuTrendFlow.md","lastUpdated":1746376832000}'),k={name:"mt5_strategy/IchimokuTrendFlow.md"};function t(p,s,e,r,d,E){return h(),a("div",null,s[0]||(s[0]=[n('<h1 id="教学ea-ichimokutrendflow-市场噪声-原文" tabindex="-1">教学EA-IchimokuTrendFlow-市场噪声_原文 <a class="header-anchor" href="#教学ea-ichimokutrendflow-市场噪声-原文" aria-label="Permalink to &quot;教学EA-IchimokuTrendFlow-市场噪声_原文&quot;">​</a></h1><p>2025年04月17日 21:57</p><h2 id="一、前言" tabindex="-1">一、前言 <a class="header-anchor" href="#一、前言" aria-label="Permalink to &quot;一、前言&quot;">​</a></h2><p>大家好，上一个教学范例讲解了<strong>市场噪声</strong>的概念。本章内容围绕<strong>一目均衡云（Ichimoku Kinko Hyo）指标</strong>展开，同样运用市场噪声概念，但场景为<strong>顺势市场环境</strong>。我们将先介绍一目均衡云指标，再讲解基于该指标设计的交易系统，最后逐行分析代码实现。</p><h2 id="二、一目均衡云指标-ichimoku-kinko-hyo" tabindex="-1">二、一目均衡云指标（Ichimoku Kinko Hyo） <a class="header-anchor" href="#二、一目均衡云指标-ichimoku-kinko-hyo" aria-label="Permalink to &quot;二、一目均衡云指标（Ichimoku Kinko Hyo）&quot;">​</a></h2><h3 id="_1-指标概述" tabindex="-1">1. 指标概述 <a class="header-anchor" href="#_1-指标概述" aria-label="Permalink to &quot;1. 指标概述&quot;">​</a></h3><p>一目均衡云是综合性技术分析指标，可用于确定支撑阻力、趋势方向及进出场点位。其核心优势是通过单一指标覆盖市场多维度信息，无需依赖其他指标即可构建完整交易系统。</p><h3 id="_2-五条关键线" tabindex="-1">2. 五条关键线 <a class="header-anchor" href="#_2-五条关键线" aria-label="Permalink to &quot;2. 五条关键线&quot;">​</a></h3><p>指标由五条线组成，以下为核心参数与功能：</p><ul><li><strong>转折线（Turning Line，快线）</strong>：<br> 计算方式为过去9根K线最高价与最低价的平均值（(H+L)/2），代表短期趋势，敏感性高。</li><li><strong>基线（Base Line，慢线）</strong>：<br> 计算方式为过去26根K线最高价与最低价的平均值，反映中期潜在支撑阻力。</li><li><strong>先行线A（Span A，云上线）</strong>：<br> 计算方式为转折线与基线的平均值，向前平移26根K线，构成云带上沿，代表潜在支撑阻力。</li><li><strong>先行线B（Span B，云下线）</strong>：<br> 计算方式为过去52根K线最高价与最低价的平均值，向前平移26根K线，构成云带下沿。</li><li><strong>滞后线（Lagging Line）</strong>：<br> 当前K线收盘价向后平移26根K线，用于辅助判断趋势（本系统未采用）。</li></ul><h3 id="_3-可视化特征" tabindex="-1">3. 可视化特征 <a class="header-anchor" href="#_3-可视化特征" aria-label="Permalink to &quot;3. 可视化特征&quot;">​</a></h3><ul><li>云带：先行线A（黄色）与先行线B（白色）构成，区间内为震荡区域，区间外为趋势方向。</li><li>快慢线：转折线（红色）与基线（蓝色），类似均线交叉信号。</li><li>滞后线（绿色）：向后平移产生，近26根K线无数据。</li></ul><p><img src="'+l+`" alt=""></p><h2 id="三、交易系统设计" tabindex="-1">三、交易系统设计 <a class="header-anchor" href="#三、交易系统设计" aria-label="Permalink to &quot;三、交易系统设计&quot;">​</a></h2><h3 id="_1-核心逻辑-以多单为例-空单反向" tabindex="-1">1. 核心逻辑（以多单为例，空单反向） <a class="header-anchor" href="#_1-核心逻辑-以多单为例-空单反向" aria-label="Permalink to &quot;1. 核心逻辑（以多单为例，空单反向）&quot;">​</a></h3><h4 id="进场条件" tabindex="-1">进场条件： <a class="header-anchor" href="#进场条件" aria-label="Permalink to &quot;进场条件：&quot;">​</a></h4><ol><li><strong>无多单持仓</strong>；</li><li><strong>快慢线黄金交叉</strong>（快线向上穿越慢线）；</li><li><strong>市场噪声滤网</strong>：噪声指标值 &gt; 0.55（低噪声环境）；</li><li><strong>趋势滤网</strong>：当前K线收盘价位于云上线（Span A）上方。</li></ol><h4 id="出场条件" tabindex="-1">出场条件： <a class="header-anchor" href="#出场条件" aria-label="Permalink to &quot;出场条件：&quot;">​</a></h4><ol><li><strong>有多单持仓</strong>；</li><li><strong>快慢线死亡交叉</strong>（快线向下穿越慢线）。</li></ol><h4 id="止损与止盈" tabindex="-1">止损与止盈： <a class="header-anchor" href="#止损与止盈" aria-label="Permalink to &quot;止损与止盈：&quot;">​</a></h4><ul><li><strong>止损</strong>：设于云下线（Span B）下方（取云上线与云下线中的较远边界）；</li><li><strong>止盈</strong>：不设固定止盈，仅通过死亡交叉或止损出场（原设计含跟踪止损，因绩效未提升已移除）。</li></ul><h3 id="_2-滤网作用" tabindex="-1">2. 滤网作用 <a class="header-anchor" href="#_2-滤网作用" aria-label="Permalink to &quot;2. 滤网作用&quot;">​</a></h3><ul><li><strong>市场噪声滤网</strong>：确保在趋势清晰（低噪声）环境交易，避免震荡行情。</li><li><strong>趋势滤网</strong>：价格位于云上线之上定义为多头趋势，反之空头趋势（原尝试滞后线判断趋势，因绩效不佳改用价格与云带关系）。</li></ul><h2 id="四、代码实现解析" tabindex="-1">四、代码实现解析 <a class="header-anchor" href="#四、代码实现解析" aria-label="Permalink to &quot;四、代码实现解析&quot;">​</a></h2><h3 id="_1-库与参数声明" tabindex="-1">1. 库与参数声明 <a class="header-anchor" href="#_1-库与参数声明" aria-label="Permalink to &quot;1. 库与参数声明&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;indicators/TrendMQH.mqh&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 一目均衡云指标库  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;Trade\\Trade.mqh&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // 交易相关库  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;Math\\Math.mqh&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 数学计算库  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;System\\ArrayObj.mqh&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 数组操作库  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 外部参数（可优化）  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InpTimeFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PERIOD_H1;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 时间周期  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InpTenkanPeriod </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 快线周期（默认9）  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InpKijunPeriod </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 慢线周期（默认26）  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InpNoiseThreshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.55</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 噪声阈值（默认0.55）  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全局变量  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CIchimokuKinkoHyo Ichimoku;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // 一目均衡云对象  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CTrade Trade;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                          // 交易对象  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoiseBuffer[];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  // 市场噪声指标缓冲区</span></span></code></pre></div><h3 id="_2-初始化-oninit" tabindex="-1">2. 初始化（OnInit） <a class="header-anchor" href="#_2-初始化-oninit" aria-label="Permalink to &quot;2. 初始化（OnInit）&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 创建一目均衡云指标  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, InpTimeFrame, InpTenkanPeriod, InpKijunPeriod);  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 初始化市场噪声指标句柄  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoiseHandle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> iCustom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_Symbol, InpTimeFrame, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MarketNoise&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...);  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ArraySetAsSeries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NoiseBuffer, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INIT_SUCCEEDED);  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-主逻辑-ontick" tabindex="-1">3. 主逻辑（OnTick） <a class="header-anchor" href="#_3-主逻辑-ontick" aria-label="Permalink to &quot;3. 主逻辑（OnTick）&quot;">​</a></h3><h4 id="数据获取" tabindex="-1">数据获取 <a class="header-anchor" href="#数据获取" aria-label="Permalink to &quot;数据获取&quot;">​</a></h4><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 跳过未完成K线  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IsNewBar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 获取市场噪声数据  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CopyBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NoiseHandle, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NoiseBuffer);  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 刷新一目均衡云数据并获取各线数值  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tenkan </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tenkan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 前一根K线快线值  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Kijun </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Kijun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 前一根K线慢线值  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SpanA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SpanA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 前一根K线云上线  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Close </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> iClose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_Symbol, InpTimeFrame, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 前一根K线收盘价</span></span></code></pre></div><h4 id="持仓检查与进场条件" tabindex="-1">持仓检查与进场条件 <a class="header-anchor" href="#持仓检查与进场条件" aria-label="Permalink to &quot;持仓检查与进场条件&quot;">​</a></h4><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 检查多单持仓  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LongPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CountPositionsBySymbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_Symbol, POSITION_TYPE_BUY);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LongPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 黄金交叉判断（避免多根K线值相同的模糊情况）  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IsCrossUp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CheckCrossUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Tenkan, Kijun, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 向前检查2根K线确认交叉  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 滤网条件：低噪声 + 价格在云上线之上  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IsCrossUp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoiseBuffer[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InpNoiseThreshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Close </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SpanA) {  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 计算止损（取云下线作为止损位）  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StopLoss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SpanB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 开多单  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Trade.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Buy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CalculateLotSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), _Symbol, Ask, StopLoss, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Ichimoku Trend Flow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><h4 id="出场条件-死亡交叉平仓" tabindex="-1">出场条件（死亡交叉平仓） <a class="header-anchor" href="#出场条件-死亡交叉平仓" aria-label="Permalink to &quot;出场条件（死亡交叉平仓）&quot;">​</a></h4><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 检查空单持仓并反向逻辑（略）  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ShortPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CountPositionsBySymbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_Symbol, POSITION_TYPE_SELL);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ShortPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CheckCrossDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Tenkan, Kijun, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Trade.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sell</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ShortPos);  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-关键函数-交叉判断" tabindex="-1">4. 关键函数：交叉判断 <a class="header-anchor" href="#_4-关键函数-交叉判断" aria-label="Permalink to &quot;4. 关键函数：交叉判断&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CheckCrossUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> currentFast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> currentSlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> lookback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 向前检查lookback根K线，确认快线从下向上穿过慢线  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lookback; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prevFast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tenkan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prevSlow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ichimoku.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Kijun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (prevFast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prevSlow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentFast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentSlow) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="五、注意事项" tabindex="-1">五、注意事项 <a class="header-anchor" href="#五、注意事项" aria-label="Permalink to &quot;五、注意事项&quot;">​</a></h2><ol><li><strong>交叉信号特殊性</strong>：快慢线可能因多根K线值相同导致交叉信号模糊，需向前多根K线确认。</li><li><strong>指标获取方式</strong>：使用MQL5封装的<code>CIchimokuKinkoHyo</code>类，通过对象方法直接获取各线数值，无需<code>CopyBuffer</code>。</li><li><strong>参数优化</strong>：快线/慢线周期、噪声阈值可通过回测优化，找到最佳组合。</li></ol><h2 id="六、总结" tabindex="-1">六、总结 <a class="header-anchor" href="#六、总结" aria-label="Permalink to &quot;六、总结&quot;">​</a></h2><p>本章结合一目均衡云与市场噪声，构建了趋势跟随交易系统。通过快慢线交叉确定进出场，云带与噪声滤网过滤无效信号。后续可尝试添加跟踪止损或结合其他指标优化策略。希望大家动手实践，利用RSI、均线、布林带等指标设计更多交易系统。</p><p><strong>谢谢观看！</strong></p>`,42)]))}const y=i(k,[["render",t]]);export{o as __pageData,y as default};
