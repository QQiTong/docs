import{_ as i,c as a,ag as n,o as t}from"./chunks/framework.CCnnzLsu.js";const l="/assets/1.B3KLKERd.png",h="/assets/7.zZaN4VpU.png",k="/assets/3.Ck96y94K.png",e="/assets/4.aBkpjgtC.png",p="/assets/5.FvPCzRcW.png",r="/assets/6.Bxnkg_ol.png",F=JSON.parse('{"title":"评价函数与相关系数R平方","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://vite.dev/mt5_quick_start/advance_konwledge/evaluation_function"}],["meta",{"property":"og:title","content":"评价函数与相关系数R平方"}]]},"headers":[],"relativePath":"mt5_quick_start/advance_konwledge/evaluation_function.md","filePath":"mt5_quick_start/advance_konwledge/evaluation_function.md","lastUpdated":1745411614000}'),E={name:"mt5_quick_start/advance_konwledge/evaluation_function.md"};function d(g,s,o,y,c,u){return t(),a("div",null,s[0]||(s[0]=[n('<h1 id="评价函数与相关系数r平方" tabindex="-1">评价函数与相关系数R平方 <a class="header-anchor" href="#评价函数与相关系数r平方" aria-label="Permalink to &quot;评价函数与相关系数R平方&quot;">​</a></h1><h2 id="一、评价函数的核心作用" tabindex="-1">一、评价函数的核心作用 <a class="header-anchor" href="#一、评价函数的核心作用" aria-label="Permalink to &quot;一、评价函数的核心作用&quot;">​</a></h2><p>评价函数是量化交易中度量和比较策略/参数性能的关键工具。在MT5参数优化中，它决定了不同参数组合的排序逻辑（如按盈利、风险或综合指标排序）。</p><h2 id="二、常见评价函数对比" tabindex="-1">二、常见评价函数对比 <a class="header-anchor" href="#二、常见评价函数对比" aria-label="Permalink to &quot;二、常见评价函数对比&quot;">​</a></h2><table tabindex="0"><thead><tr><th><strong>指标</strong></th><th><strong>定义</strong></th><th><strong>优缺点</strong></th></tr></thead><tbody><tr><td><strong>最大结余 max balance</strong></td><td>净利润总和</td><td>仅关注收益，忽略风险，片面性强</td></tr><tr><td><strong>最大回撤 max drawdown</strong></td><td>净值从最高点到最低点的最大跌幅</td><td>仅关注风险，忽略收益，片面性强</td></tr><tr><td><strong>盈利因子profit factor</strong></td><td>总盈利 / 总亏损（&gt;1为盈利）</td><td>综合收益与亏损，衡量策略盈亏比</td></tr><tr><td><strong>采收率（风报比recovery factory）</strong></td><td>净盈利 / 最大回撤</td><td>风险收益比，数值越大表明单位风险回报越高</td></tr><tr><td><strong>夏普比率 sharp ratio</strong></td><td>（收益-无风险利率）/ 波动率</td><td>经典风险调整收益指标，需假设无风险利率</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">提示</p><p>按照每年采收率0.5来算回测10年需要达到5才算及格</p></div><h2 id="三、核心主题-相关系数r平方" tabindex="-1">三、核心主题：相关系数R平方 <a class="header-anchor" href="#三、核心主题-相关系数r平方" aria-label="Permalink to &quot;三、核心主题：相关系数R平方&quot;">​</a></h2><h3 id="_1-统计学原理" tabindex="-1">1. 统计学原理 <a class="header-anchor" href="#_1-统计学原理" aria-label="Permalink to &quot;1. 统计学原理&quot;">​</a></h3><ul><li><strong>Pearson相关系数（R）</strong>：衡量两个变量线性相关程度，范围[-1, 1]。 <ul><li><strong>R=1</strong>：完全正相关；<strong>R=-1</strong>：完全负相关；<strong>R=0</strong>：无线性相关。</li></ul></li><li><strong>R平方（R²）</strong>：R的平方，反映变量变异中可由线性回归解释的比例，范围[0, 1]。</li></ul><h3 id="_2-在资金曲线上的应用" tabindex="-1">2. 在资金曲线上的应用 <a class="header-anchor" href="#_2-在资金曲线上的应用" aria-label="Permalink to &quot;2. 在资金曲线上的应用&quot;">​</a></h3><h4 id="_1-核心目标" tabindex="-1">（1）核心目标 <a class="header-anchor" href="#_1-核心目标" aria-label="Permalink to &quot;（1）核心目标&quot;">​</a></h4><p>通过线性回归拟合资金曲线，计算R²值，判断资金增长的“稳定性”与“线性程度”。理想状态是资金曲线贴近一条稳定上升的直线（R²→1）。</p><h4 id="_2-案例分析" tabindex="-1">（2）案例分析 <a class="header-anchor" href="#_2-案例分析" aria-label="Permalink to &quot;（2）案例分析&quot;">​</a></h4><ul><li><strong>优质曲线</strong>：R²=0.9561，资金点紧密围绕拟合线，增长稳健。</li><li><strong>劣质曲线</strong>：R²=0.43，资金点分散，波动剧烈。</li><li><strong>特殊情况</strong>：R²=0.88但为负值，表明资金稳定下跌（负相关），需排除。</li></ul><h2 id="二、相关系数r平方-一种独特的评价视角" tabindex="-1">二、相关系数R平方：一种独特的评价视角 <a class="header-anchor" href="#二、相关系数r平方-一种独特的评价视角" aria-label="Permalink to &quot;二、相关系数R平方：一种独特的评价视角&quot;">​</a></h2><h3 id="_1-统计学背景" tabindex="-1">1. <strong>统计学背景</strong> <a class="header-anchor" href="#_1-统计学背景" aria-label="Permalink to &quot;1. **统计学背景**&quot;">​</a></h3><ul><li><strong>Pearson相关系数（R）</strong>：衡量两个变量线性相关程度，范围在[-1, 1]之间。 <ul><li><strong>+1</strong>：完全正相关，<strong>-1</strong>：完全负相关，<strong>0</strong>：无线性相关。</li></ul></li></ul><p><img src="'+l+'" alt=""></p><ul><li><strong>R平方（R²）</strong>：相关系数的平方，反映变量与拟合直线的贴近程度，值越接近1，线性相关性越强。</li></ul><h3 id="_2-在资金曲线上的应用-1" tabindex="-1">2. <strong>在资金曲线上的应用</strong> <a class="header-anchor" href="#_2-在资金曲线上的应用-1" aria-label="Permalink to &quot;2. **在资金曲线上的应用**&quot;">​</a></h3><ul><li><strong>使用方法</strong><ul><li>用最大结余那一列绘制折线图</li><li>图表选中生成趋势线</li><li>在点击趋势线后，右侧选线显示R平方值</li></ul></li></ul><p><img src="'+h+'" alt=""></p><ul><li><strong>核心思想</strong>：通过线性回归拟合资金曲线，计算其与拟合直线的相关系数R²，衡量收益的稳定性和质量。</li><li><strong>示例分析</strong>： <ul><li><strong>高R²（如0.95）</strong>：资金曲线贴近直线，收益稳健（如图1）。</li><li><strong>低R²（如0.43或0.23）</strong>：曲线波动大，与直线偏离度高（如图2,图3）。</li><li><strong>负R²（如-0.86）</strong>：资金曲线稳定下降，呈现负相关（如图4）。</li></ul></li></ul><p><img src="'+k+'" alt=""></p><p><img src="'+e+'" alt=""></p><p><img src="'+p+'" alt=""></p><p><img src="'+r+`" alt=""></p><h3 id="_3-使用注意事项" tabindex="-1">3. <strong>使用注意事项</strong> <a class="header-anchor" href="#_3-使用注意事项" aria-label="Permalink to &quot;3. **使用注意事项**&quot;">​</a></h3><ul><li><strong>仓位固定</strong>：相关系数基于线性回归，要求仓位计算为固定类型（1或3模式）详情见<a href="/mt5_quick_start/first_real_ea/risk_manage">4种仓位管理方式</a>，避免动态仓位导致的指数型曲线干扰拟合效果。</li><li><strong>交易频率</strong>：需设定最低交易笔数（如每年≥24笔），避免样本不足影响评价有效性。</li></ul><h2 id="三、代码实现" tabindex="-1">三、代码实现 <a class="header-anchor" href="#三、代码实现" aria-label="Permalink to &quot;三、代码实现&quot;">​</a></h2><h3 id="_1-核心逻辑" tabindex="-1">1. <strong>核心逻辑</strong> <a class="header-anchor" href="#_1-核心逻辑" aria-label="Permalink to &quot;1. **核心逻辑**&quot;">​</a></h3><ul><li><strong>数据准备</strong>：记录每笔交易后的资金余额（Y轴）与交易笔数（X轴）。</li><li><strong>函数调用</strong>：利用MT5内置库计算相关系数，避免手动实现复杂公式。</li></ul><h3 id="_2-代码示例" tabindex="-1">2. <strong>代码示例</strong> <a class="header-anchor" href="#_2-代码示例" aria-label="Permalink to &quot;2. **代码示例**&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MQLInfoInteger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MQL_TESTER)){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BackTestFirstDate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TimeCurrent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        StartingEquity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AccountInfoDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ACCOUNT_EQUITY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;Math\\Stat\\Stat.mqh&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Required for MathStandardDeviation()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">datetime BackTestFirstDate;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 回测开始时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StartingEquity;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 存储起始资产余额(即回测开始的存款金额)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnTester</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> customPerformaceMetric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numTrades </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoeffCorrelation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(customPerformaceMetric,StartingEquity);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. 这是回测持续时间(以秒为单位), 但为避免下方出现问题, 需将其强制转换为双精度类型  2. &quot;秒&quot;转换为&quot;年&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    datetime BackTestFinalDate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TimeCurrent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BackTestDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BackTestFinalDate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BackTestFirstDate);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    BackTestDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (((( BackTestDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">365.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> needTrades </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BackTestDuration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 每年至少24笔交易</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(numTrades</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">needTrades)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        customPerformaceMetric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    customPerformaceMetric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NormalizeDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(customPerformaceMetric,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> customPerformaceMetric;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//计算相关系数R,这将产生与确定系数(Coeff of Determination)相同的挂名</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//相关系数R的值介于-1和+1之间。确定系数(R-Squared)只是相关系数的平方。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//因此,它的范围为@到1。但是，出于我们的目的，我们希望保留符号，以便知道资产曲线是上涨还是下跌。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//接近+1的值表示非常平艳的上涨趋势。接近-1的值表示非常平稳的下跌隐势(即非常建糕)，接近8的值表示盈亏平衡的系统，具省波动的资产曲线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//例如,0.6的值表示具有波动资产曲线的盈利系统。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//交易次数(从8开始，并以1逆增)用于X值。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//系积资产值用于Y值。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//相关系数公式:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// r =( n(SLM(x))-(SUM(x))(Sum(y)))/( SORT( n(SuN(x-squared)- suM(x)squared))* SORT(n(SLM(y-squared))- SLM(y)squared))1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//r值为正表示资产曲线上涨-G00D。与+1越接近，资产曲线上涨趋势就越高效。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//r值为负表示资产曲线下跌-BAD。越接近-1，资产曲线下跌趋势也越高效。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//接近+1表示上涨趋势，接近-1表示下跌趋势，接近0表示资产曲线有波动。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoeffCorrelation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dCustomPerformanceMetric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> dStartingEquity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //初始化两个数组，作为计算相关系数的基础数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //数组&quot;equityID&quot;和&quot;cumNormalisedNetProfit” 分配初始空间，大小设置为1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numEquityValues </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equityID[]; </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cumNormalisedNetProfit[];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ArrayResize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equityID, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ArrayResize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cumNormalisedNetProfit, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用1.0赋 初值给equityID 对应的第一个值, 也就是x值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    equityID[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用初始资产价值赋初值给customNormalisedNetProfit 对应的第一个值, 也就是y值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cumNormalisedNetProfit[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dStartingEquity;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 循环遍历所有的历史交易记录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    HistorySelect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeCurrent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numDeals </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HistoryDealsTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deaID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;deaID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">numDeals;deaID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ulong dealTicket </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HistoryDealGetTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deaID);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HistoryDealGetInteger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dealTicket,DEAL_ENTRY) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEAL_ENTRY_OUT){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            numEquityValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tradeNetProfit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HistoryDealGetDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dealTicket,DEAL_PROFIT)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                     HistoryDealGetDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dealTicket,DEAL_SWAP)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                     2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HistoryDealGetDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dealTicket,DEAL_COMMISSION);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 获取交易的数量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tradeVolume </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HistoryDealGetDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dealTicket,DEAL_VOLUME);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 数组扩充空间,存储本次交易的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            ArrayResize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equityID,numEquityValues);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            ArrayResize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cumNormalisedNetProfit,numEquityValues);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 将交易次数存入equityID, 将归一化的资产价值加入到cumNormalisedNetProfit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // tradeNetProfit/tradeVolume 就是当前交易后的归一化资产价值, 然后它被价到上一次计算的累积资产价值上,从而的到了这一次交易后的累积资产价值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            equityID[numEquityValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)numEquityValues;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            cumNormalisedNetProfit[numEquityValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cumNormalisedNetProfit[numEquityValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (tradeNetProfit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tradeVolume);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 初始化相关系数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> coeffOfCorrelation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用MQL5内置函数计算pearson相关系数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MathCorrelationPearson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equityID,cumNormalisedNetProfit,coeffOfCorrelation)) coeffOfCorrelation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 将结果相关系数值存入dCustomPerformanceMetric</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dCustomPerformanceMetric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> coeffOfCorrelation;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numEquityValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-优化效果" tabindex="-1">3. <strong>优化效果</strong> <a class="header-anchor" href="#_3-优化效果" aria-label="Permalink to &quot;3. **优化效果**&quot;">​</a></h3><ul><li><strong>排序依据</strong>：参数优化时选择“最大定制”，优先筛选资金曲线贴近稳定上升直线的参数。</li><li><strong>结果示例</strong>： <ul><li><strong>高R²（0.97）</strong>：资金曲线稳定上涨，排名靠前。</li><li><strong>负R²（-0.96）</strong>：稳定亏损，排名靠后。</li><li><strong>低R²（0.12）</strong>：波动剧烈，无明显趋势，排名居中。</li></ul></li></ul><h2 id="四、总结" tabindex="-1">四、总结 <a class="header-anchor" href="#四、总结" aria-label="Permalink to &quot;四、总结&quot;">​</a></h2><p>相关系数R平方从统计学角度为策略评价提供了新维度，关注资金曲线的“线性稳健性”，弥补了传统指标（如单纯利润或回撤）的片面性。使用时需注意仓位固定和交易频率要求，适用于追求稳定收益的策略优化。建议结合其他指标综合评估，提升参数筛选的可靠性。</p>`,38)]))}const A=i(E,[["render",d]]);export{F as __pageData,A as default};
